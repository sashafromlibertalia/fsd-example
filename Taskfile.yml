version: "3"

env:
  COMPOSE_PROJECT_NAME: feature-sliced-example
  PROJECT_ID: 003
  DOCKER_BUILDKIT: 1

tasks:
  default:
    silent: true
    cmds:
      - task --list

  init:
    silent: true
    desc: Инициализация проекта
    cmds:
      - task clean
      - task install
      - task start
      - task info

  clean:
    silent: true
    desc: Очистка контейнеров
    cmds:
      - docker-compose down --rmi local -v

  install:
    silent: true
    desc: Установка зависимостей
    cmds:
      - docker-compose run --no-deps --rm -T frontend npm install

  start:
    silent: true
    desc: Запуск проекта
    cmds:
      - docker-compose up -d --no-build

  restart:
    silent: true
    desc: Перезапуск проекта
    cmds:
      - task clean
      - task start
      - task info

  stop:
    silent: true
    desc: Остановка проекта
    cmds:
      - docker-compose stop

  lint:
    silent: true
    desc: Проверка кода
    cmds:
      - printf "\033[33m%s:\033[0m\n" 'ESLint'
      - docker-compose exec -T frontend npm run eslint
      - printf "\033[33m%s:\033[0m\n" 'Stylelint'
      - docker-compose exec -T frontend npm run stylelint

  cs-fix:
    silent: true
    desc: Форматирование кода
    cmds:
      - printf "\033[33m%s:\033[0m\n" 'ESLint'
      - docker-compose exec -T frontend npm run eslint:fix
      - printf "\033[33m%s:\033[0m\n" 'Stylelint'
      - docker-compose exec -T frontend npm run stylelint:fix

  ps:
    silent: true
    desc: Список запущенных контейнеров
    cmds:
      - docker-compose ps

  info:
    silent: true
    desc: Информация о проекте
    cmds:
      - echo "site - http://localhost:20${PROJECT_ID}"
